(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{288:function(t,e,i){"use strict";i.r(e);var s=i(16),o=i(23),a=i(267);let r;var d={components:{AceEditor:i.n(a).a},async mounted(){try{await this.$store.dispatch("guilds/loadGuild",this.$route.params.guildId)}catch(t){if(t instanceof o.a)return void this.$router.push("/dashboard");throw t}null!=this.guild?(await this.$store.dispatch("guilds/loadConfig",this.$route.params.guildId),this.editableConfig=this.config||"",this.loading=!1):this.$router.push("/dashboard")},beforeRouteLeave(t,e,i){r&&(window.removeEventListener("keydown",r),r=null),i()},data:()=>({loading:!0,saving:!1,saved:!1,editableConfig:null,errors:[],editorWidth:900,editorHeight:600,savedTimeout:null}),computed:{...Object(s.b)("guilds",{guild(t){return t.available.get(this.$route.params.guildId)},config(t){return t.configs[this.$route.params.guildId]}})},methods:{editorInit(){i(270),i(271),i(272),i(273),this.$refs.aceEditor.editor.setOptions({useSoftTabs:!0,tabSize:2});const t=/mac/i.test(navigator.platform),e=e=>(e=>t?e.metaKey:e.ctrlKey)(e)&&!(e=>t?e.ctrlKey:e.metaKey)(e)&&!e.altKey;r&&window.removeEventListener("keydown",r),r=t=>e(t)&&"s"===t.key?(t.preventDefault(),void this.save()):e(t)&&"f"===t.key?(t.preventDefault(),void this.$refs.aceEditor.editor.execCommand("find")):void 0,window.addEventListener("keydown",r),this.fitEditorToWindow()},fitEditorToWindow(){const t=document.querySelector(".dashboard"),e=window.getComputedStyle(t),i=this.$refs.aceEditor.$el,s=i.parentNode.clientWidth,o=i.getBoundingClientRect(),a=Math.round(window.innerHeight-o.top-parseInt(e.paddingLeft,10));this.resizeEditor(s,a)},resizeEditor(t,e){this.editorWidth=t,this.editorHeight=e,this.$nextTick(()=>{this.$refs.aceEditor.editor.resize()})},async save(){if(this.saving)return;this.saved=!1,this.saving=!0,this.errors=[],this.savedTimeout&&clearTimeout(this.savedTimeout);const t=new Promise(t=>setTimeout(t,300));try{await this.$store.dispatch("guilds/saveConfig",{guildId:this.$route.params.guildId,config:this.editableConfig}),await t,this.saving=!1,this.saved=!0,this.savedTimeout=setTimeout(()=>this.saved=!1,3e3)}catch(t){if(t instanceof o.a&&(400===t.status||422===t.status))return this.errors=t.body.errors||["Error while saving config"],void(this.saving=!1);throw t}}}},n=i(8),l=Object(n.a)(d,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.loading?i("div",[t._v("\n  Loading...\n")]):i("div",[t.errors.length?i("div",{staticClass:"bg-gray-800 py-2 px-3 rounded shadow-md mb-4"},[i("div",{staticClass:"font-semibold"},[t._v("Errors:")]),t._v(" "),t._l(t.errors,(function(e){return i("div",[t._v(t._s(e))])}))],2):t._e(),t._v(" "),i("div",{staticClass:"flex items-center flex-wrap"},[i("h1",{staticClass:"flex-full md:flex-auto"},[t._v("Config for "+t._s(t.guild.name))]),t._v(" "),t.saving?t._e():i("button",{staticClass:"flex-none bg-green-800 px-5 py-2 rounded hover:bg-green-700",on:{click:t.save}},[t.saved?i("span",[t._v("Saved!")]):i("span",[t._v("Save")])]),t._v(" "),t.saving?i("div",{staticClass:"flex-none bg-gray-700 px-5 py-2 rounded"},[t._v("\n      Saving...\n    ")]):t._e()]),t._v(" "),i("AceEditor",{ref:"aceEditor",staticClass:"rounded shadow-lg border border-gray-700 mt-4",attrs:{lang:"yaml",theme:"tomorrow_night",width:t.editorWidth,height:t.editorHeight},on:{init:t.editorInit},model:{value:t.editableConfig,callback:function(e){t.editableConfig=e},expression:"editableConfig"}})],1)}),[],!1,null,null,null);e.default=l.exports}}]);
//# sourceMappingURL=17.6c3f32137192f26bcd0f.js.map